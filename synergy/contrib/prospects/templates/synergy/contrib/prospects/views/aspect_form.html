<form action="{{ request.get_full_url }}" method="POST">

  <table id="prospect-form-table">
    <thead>
      {% for field in form.get_aspect_fields %}
      <th class="ui-state-default">{{ field.label_tag }}</th>
      {% endfor %}
    </thead>
  <tr>
    {% for field in form.get_aspect_fields %}
    <td>{{ field.errors }}</td>
    {% endfor %}
  </tr>
  <tr>
    {% for field in form.get_aspect_fields %}
  <td>{{ field }}</td>
  {% endfor %}
  </tr>    

  <tr>
    {% for field in form.get_lookup_fields %}
  <td>{{ field }}</td>
  {% endfor %}
  </tr>    
  </table>


{% for context, context_form in form.contexts.iteritems %}

{% if context_form.fields %}

<fieldset>
  <legend>{{ context.variant.verbose_name }}</legend>

  <table id="prospect-form-table">
    <thead>
      {% for field in context_form.get_aspect_fields %}
      <th class="ui-state-default">{{ field.label_tag }}</th>
      {% endfor %}
    </thead>
  <tr>
    {% for field in context_form.get_aspect_fields %}
    <td>{{ field.errors }}</td>
    {% endfor %}
  </tr>
  <tr>
    {% for field in context_form.get_aspect_fields %}
  <td>{{ field }}</td>
  {% endfor %}
  </tr>    

  <tr>
    {% for field in context_form.get_lookup_fields %}
  <td>{{ field }}</td>
  {% endfor %}
  </tr>    
  </table>
</fieldset>

{% endif %}

{% endfor %}

{% csrf_token %}
<p>
  <input id="prospect-form-submit" type="submit" value="{{ variant.submit_label|default:"Submit" }}" />
</p>
</form>
